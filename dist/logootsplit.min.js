!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("logootsplit",[],t):"object"==typeof exports?exports.logootsplit=t():e.logootsplit=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(1),s=(r(i),n(2)),a=r(s),o=n(3),u=r(o),f=n(4),l=r(f),h=n(5),c=r(h),d=n(6),v=r(d),g=n(7),y=r(g);window.Base=u["default"],window.RemoteCommand=a["default"],window.CharId=l["default"],window.Char=c["default"],window.Document=v["default"],window.Algorithm=y["default"]},function(e,t){"use strict";window.MIN_BASE_EL=0,window.MAX_BASE_EL=1e7,window.MIN_OFFSET=MIN_BASE_EL+1,window.MAX_OFFSET=MAX_BASE_EL,window.FIRST_ASSIGNED_OFFSET=Math.floor(MAX_OFFSET/2)},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,[{key:"makeAddCommand",value:function(e,t,n){this.type="add",this.str=e,this.id=t,this.sessionId=n}},{key:"makeDelCommand",value:function(e,t){this.type="del",this.ids=e,this.sessionId=t}}]),e}();t["default"]=i,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r,i){n(this,e),this.main=t,this.sessionId=r,this.clock=i,this.minUsedOffset=MAX_OFFSET+1,this.maxUsedOffset=MIN_OFFSET-1}return r(e,[{key:"isEqual",value:function(e){if(this.sessionId!==e.sessionId||this.clock!==e.clock||this.main.length!==e.main.length)return!1;for(var t=0;t<this.main.length;++t)if(this.main[t]!=e.main[t])return!1;return!0}},{key:"isPrefix",value:function(e){var t=this.fullBase,n=e.fullId;if(t.length>n.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!=n[r])return!1;return!0}},{key:"fullBase",get:function(){return this.main.concat([this.sessionId],[this.clock])}},{key:"copy",get:function(){return new e(this.main.slice(),this.sessionId,this.clock)}}]),e}();t["default"]=i,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r){n(this,e),this.base=t,this.offset=r,this.offset>t.maxUsedOffset&&(t.maxUsedOffset=this.offset),this.offset<t.minUsedOffset&&(t.minUsedOffset=r)}return r(e,[{key:"isEqual",value:function(e){return this.base.isEqual(e.base)&&this.offset===e.offset}},{key:"isBigger",value:function(e){for(var t=this.fullId,n=e.fullId,r=0;r<Math.min(t.length,n.length);++r)if(t[r]!==n[r])return t[r]>n[r];return t.length>n.length}},{key:"fullId",get:function(){return this.base.fullBase.concat(this.offset)}},{key:"copy",get:function(){return new e(this.base.copy,this.offset)}}]),e}();t["default"]=i,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r){n(this,e),this.value=t,this.id=r}return r(e,[{key:"isEqual",value:function(e){return this.value===e.value&&this.id.isEqual(e.id)}}]),e}();t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(3),o=r(a),u=n(4),f=r(u),l=n(5),h=r(l),c=new h["default"](null,new f["default"](new o["default"]([MIN_BASE_EL-1],MIN_BASE_EL-1,MIN_BASE_EL-1),MIN_OFFSET-1)),d=new h["default"](null,new f["default"](new o["default"]([MAX_BASE_EL+1],MAX_BASE_EL+1,MAX_BASE_EL+1),MAX_OFFSET+1)),v=function(){function e(){i(this,e),this.chars=[c,d],this.bases=[]}return s(e,[{key:"insertStrAppended",value:function(e,t){var n=this.chars[t-1],r=n.id.base,i=n.id.offset+1;this.insertStringWithExistingBase(e,t,r,i)}},{key:"insertStrPrepended",value:function(e,t){var n=this.chars[t],r=n.id.base,i=n.id.offset-e.length;this.insertStringWithExistingBase(e,t,r,i)}},{key:"insertStringWithExistingBase",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:FIRST_ASSIGNED_OFFSET;this.insertStrAtPos(e,t,n,r),this.sortDocumentPart(t,this.chars.length-1)}},{key:"insertStringWithNewBase",value:function(e,t,n){this.addBase(n),this.insertStringWithExistingBase(e,t,n)}},{key:"insertStrAtPos",value:function(e,t,n,r){var i=r,s=!0,a=!1,o=void 0;try{for(var u,l=e[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var c=u.value,d=new f["default"](n,i),v=new h["default"](c,d);this.insertCharAtPos(v,t),++t,++i}}catch(g){a=!0,o=g}finally{try{!s&&l["return"]&&l["return"]()}finally{if(a)throw o}}}},{key:"addCharsAndGetChanges",value:function(e){var t=[];if(0==e.length)return t;for(var n=this.getPosOfFirstCharWithBiggerId(e[0].id),r=null,i="",s=e.length-1;s>=0;--s){var a=this.getPosOfFirstCharWithBiggerIdStartingFrom(e[s].id,n);if(r===a||""===i)i=e[s].value+i;else{var o={type:"add",string:i,position:r-1};t.push(o),i=e[s].value}0==s&&""!==i&&t.push({type:"add",string:i,position:a-1}),this.insertCharAtPos(e[s],a),r=a}return t}},{key:"sortDocumentPart",value:function(e,t){for(var n=e+1;n<=t;++n){for(var r=this.chars[n],i=n-1;i>=1&&this.chars[i].id.isBigger(r.id);--i)this.chars[i+1]=this.chars[i];this.chars[i+1]=r}}},{key:"addBase",value:function(e){this.bases.push(e)}},{key:"delChars",value:function(e,t){for(var n=t;n>=e;--n)this.delChar(n)}},{key:"delChar",value:function(e){this.chars.splice(e,1)}},{key:"getPosOfCharWithId",value:function(e){for(var t=0;t<this.chars.length;++t)if(this.chars[t].id.isEqual(e))return t;return null}},{key:"getPosOfCharWithIdStartingFrom",value:function(e,t){for(var n=t;n<this.chars.length;++n)if(this.chars[n].id.isEqual(e))return n;return null}},{key:"getPosOfFirstCharWithBiggerId",value:function(e){for(var t=1;t<this.chars.length;++t)if(this.chars[t].id.isBigger(e))return t;return null}},{key:"getPosOfFirstCharWithBiggerIdStartingFrom",value:function(e,t){for(var n=t;n<this.chars.length;++n)if(this.chars[n].id.isBigger(e))return n;return null}},{key:"getCharAtPos",value:function(e){return this.chars[e]}},{key:"getIdOfCharAtPos",value:function(e){return this.chars[e].id}},{key:"getCharIds",value:function(e,t){for(var n=[],r=e;r<=t;++r)n.push(this.chars[r].id);return n}},{key:"getSameBase",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,s=this.bases[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=i.value;if(e.isEqual(a))return a}}catch(o){n=!0,r=o}finally{try{!t&&s["return"]&&s["return"]()}finally{if(n)throw r}}return null}},{key:"insertCharAtPos",value:function(e,t){this.chars.splice(t,0,e)}},{key:"isEmpty",value:function(){return 2==this.chars.length}},{key:"showDetailedSessionState",value:function(e){console.log(e);for(var t=0;t<this.chars.length;++t)console.log("----- "+this.getCharStateStr(this.chars[t]))}},{key:"getCharStateStr",value:function(e){return e.value+":  "+e.id.fullId.toString()}},{key:"text",get:function(){for(var e="",t=0;t<this.chars.length;++t)e+=this.chars[t].value;return e}},{key:"textTest",get:function(){for(var e="",t=0;t<this.chars.length;++t)e+=0==t||t==this.chars.length-1?"":this.chars[t].value,t+1<this.chars.length&&!this.chars[t].id.base.isEqual(this.chars[t+1].id.base)&&(e+="|");return e}}]),e}();t["default"]=v,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(3),o=r(a),u=n(4),f=r(u),l=n(5),h=r(l),c=n(6),d=(r(c),n(2)),v=r(d),g=function(){function e(t,n){i(this,e),this.doc=t,this.sessionId=n,this.clock=0,this.idsOfCharsToDeleteLater=[]}return s(e,[{key:"insert",value:function(e,t){return this.insertIntoDocument(e,t),this.createRemoteAddCommand(e,t)}},{key:"remove",value:function(e,t){var n=this.doc.getCharIds(e,t),r=n.map(function(e){return e.copy});return this.doc.delChars(e,t),this.createRemoteDelCommand(r)}},{key:"add",value:function(e,t){for(var n=this.createCharsFromStr(e,t),r=n.length-1;r>=0;--r)for(var i=this.idsOfCharsToDeleteLater.length-1;i>=0;--i)if(n[r].id.isEqual(this.idsOfCharsToDeleteLater[i])){n.splice(r,1),this.idsOfCharsToDeleteLater.splice(i,1);break}var s=this.doc.addCharsAndGetChanges(n);return s}},{key:"del",value:function(e){var t=1,n=[],r=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value,f=this.doc.getPosOfCharWithIdStartingFrom(u,t);null!=f?(n.push(f),t=f):this.idsOfCharsToDeleteLater.push(u)}}catch(l){i=!0,s=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw s}}for(var h=[],c=null,d={start:null,end:null},v=n.length-1;v>=0;--v){var g=n[v];if(c===g+1||null==d.start)d=this.extendRange(d,g);else{var y={type:"del",from:d.start-1,to:d.end-1};h.push(y),d={start:g,end:g}}if(0==v&&null!=d.start){var p={type:"del",from:d.start-1,to:d.end-1};h.push(p)}c=g}for(var m=n.length-1;m>=0;--m)this.doc.delChar(n[m]);return h}},{key:"extendRange",value:function(e,t){return null==e.start?{start:t,end:t}:{start:t,end:e.end}}},{key:"createRemoteDelCommand",value:function(e){var t=new v["default"];return t.makeDelCommand(e,this.session),t}},{key:"createCharsFromStr",value:function(e,t){var n=this.doc.getSameBase(t.base);null==n&&(n=t.base);var r=[],i=t.offset,s=!0,a=!1,o=void 0;try{for(var u,l=e[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var c=u.value;r.push(new h["default"](c,new f["default"](n,i))),++i}}catch(d){a=!0,o=d}finally{try{!s&&l["return"]&&l["return"]()}finally{if(a)throw o}}return r}},{key:"insertIntoDocument",value:function(e,t){this.canInsertAppended(e,t)?this.doc.insertStrAppended(e,t):this.canInsertPrepended(e,t)?this.doc.insertStrPrepended(e,t):this.doc.insertStringWithNewBase(e,t,this.generateBaseAtPos(t))}},{key:"canInsertAppended",value:function(e,t){var n=this.doc.getCharAtPos(t-1);return this.isSameSession(n)&&this.isHighestOffsetInBase(n)&&this.isSpaceInBaseAfter(n,e.length)&&this.isNotGoingToOverlapAfterApp(e,t)}},{key:"isNotGoingToOverlapAfterApp",value:function(e,t){var n=this.doc.getIdOfCharAtPos(t-1),r=this.doc.getIdOfCharAtPos(t),i=n.copy;return i.offset+=e.length,!i.isBigger(r)}},{key:"canInsertPrepended",value:function(e,t){var n=this.doc.getCharAtPos(t);return this.isSameSession(n)&&this.isLowestOffsetInBase(n)&&this.isSpaceInBaseBefore(n,e.length)&&this.isNotGoingToOverlapAfterPrep(e,t)}},{key:"isNotGoingToOverlapAfterPrep",value:function(e,t){var n=this.doc.getIdOfCharAtPos(t-1),r=this.doc.getIdOfCharAtPos(t),i=r.copy;return i.offset-=e.length,!n.isBigger(i)}},{key:"isSameSession",value:function(e){return e.id.base.sessionId==this.sessionId}},{key:"isHighestOffsetInBase",value:function(e){return e.id.offset==e.id.base.maxUsedOffset}},{key:"isLowestOffsetInBase",value:function(e){return e.id.offset==e.id.base.minUsedOffset}},{key:"isSpaceInBaseAfter",value:function(e,t){return e.id.offset+t<MAX_BASE_EL}},{key:"isSpaceInBaseBefore",value:function(e,t){return e.id.offset-t>MIN_BASE_EL}},{key:"createRemoteAddCommand",value:function(e,t){var n=this.doc.getCharAtPos(t).id.copy,r=new v["default"];return r.makeAddCommand(e,n,this.sessionId),r}},{key:"generateBaseAtPos",value:function(e){for(var t=this.doc.getIdOfCharAtPos(e-1).fullId,n=this.doc.getIdOfCharAtPos(e).fullId,r=t[0],i=n[0],s=new o["default"]([],this.sessionId,(++this.clock)),a=1;i-r<2;++a)s.main.push(r),r=a<t.length?t[a]:MIN_BASE_EL,i=a<n.length?n[a]:MAX_BASE_EL;return s.main.push(this.getRandomElementBetween(r+1,i-1)),s}},{key:"getRandomElementBetween",value:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}}]),e}();t["default"]=g,e.exports=t["default"]}])});
//# sourceMappingURL=logootsplit.min.js.map