{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap fcfcb9dcfd5ef96455c5","webpack:///./src/index.js","webpack:///./src/Main/Const.js","webpack:///./src/Main/RemoteCommand.js","webpack:///./src/Main/LogootDoc/Base.js","webpack:///./src/Main/LogootDoc/CharId.js","webpack:///./src/Main/LogootDoc/Char.js","webpack:///./src/Main/LogootDoc/Document.js","webpack:///./src/Main/Algorithm.js","webpack:///./src/Main/DocumentChanger.js"],"names":["window","Base","RemoteCommand","CharId","Char","Document","Algorithm","DocumentChanger","MIN_BASE_EL","MAX_BASE_EL","MIN_OFFSET","MAX_OFFSET","FIRST_ASSIGNED_OFFSET","Math","floor","str","id","sessionId","type","ids","main","clock","minUsedOffset","maxUsedOffset","otherBase","length","i","charId","thisId","fullBase","otherId","fullId","concat","slice","base","offset","otherChar","isEqual","otherCharId","min","copy","value","DOC_BEG","DOC_END","chars","bases","pos","charWeAppendTo","firstOffset","insertStringWithExistingBase","charWePrependTo","insertStrAtPos","sortDocumentPart","addBase","firstCharOffset","char","newId","newChar","insertCharAtPos","changes","pos0","getPosOfFirstCharWithBiggerId","prevUsedPos","changeStr","getPosOfFirstCharWithBiggerIdStartingFrom","change","string","position","getCoordPos","push","line","column","sortBeg","sortEnd","temp","prevPos","isBigger","fromPos","toPos","delChar","splice","startPos","b","lines","text","doc","idsOfCharsToDeleteLater","insertIntoDocument","createRemoteAddCommand","strId","createCharsFromStr","j","addCharsAndGetChanges","delIds","getCharIds","delIdsCopy","map","delChars","createRemoteDelCommand","getPosOfCharWithId","remoteDelCommand","makeDelCommand","session","getSameBase","canInsertAppended","insertStrAppended","canInsertPrepended","insertStrPrepended","insertStringWithNewBase","generateBaseAtPos","getCharAtPos","isSameSession","isHighestOffsetInBase","isSpaceInBaseAfter","isNotGoingToOverlapAfterApp","prevCharId","getIdOfCharAtPos","nextCharId","lastIdOfAppStr","isLowestOffsetInBase","isSpaceInBaseBefore","isNotGoingToOverlapAfterPrep","firstIdOfPrepStr","spaceLength","addId","remoteAddCommand","makeAddCommand","idLow","idHigh","low","high","getRandomElementBetween","idInsert","idNext","strLength","isPrefix","random","algorithm","editor","getAsLines","convertToAbsolutePos","addCmd","insert","add","realDoc","getSession","getDocument","getLine"],"mappings":"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","file":"logootsplit.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"logootsplit\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"logootsplit\"] = factory();\n\telse\n\t\troot[\"logootsplit\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap fcfcb9dcfd5ef96455c5\n **/","import Const from \"./Main/Const.js\";\r\n\r\nimport RemoteCommand from \"./Main/RemoteCommand.js\";\r\nimport Base from \"./Main/LogootDoc/Base.js\";\r\nimport CharId from \"./Main/LogootDoc/CharId.js\";\r\nimport Char from \"./Main/LogootDoc/Char.js\";\r\nimport Document from \"./Main/LogootDoc/Document.js\";\r\nimport Algorithm from \"./Main/Algorithm.js\";\r\nimport DocumentChanger from \"./Main/DocumentChanger.js\"\r\n\r\nwindow.Base = Base;\r\nwindow.RemoteCommand = RemoteCommand;\r\nwindow.CharId = CharId;\r\nwindow.Char = Char;\r\nwindow.Document = Document;\r\nwindow.Algorithm = Algorithm;\r\nwindow.DocumentChanger = DocumentChanger;\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","window.MIN_BASE_EL = 0\r\n//const MAX_BASE_EL = Math.pow(2, 53) - 1\r\nwindow.MAX_BASE_EL = 1000\r\nwindow.MIN_OFFSET = MIN_BASE_EL + 1\r\nwindow.MAX_OFFSET = MAX_BASE_EL\r\nwindow.FIRST_ASSIGNED_OFFSET = Math.floor(MAX_OFFSET/2)\r\n\r\n// Char ID is represented by array of numbers, each of them in range [MIN_BASE_EL;MAX_BASE_EL]\r\n// Last element of char ID is called offset, others are called base\r\n// MIN_BASE_EL cannot be used as offset\r\n// When new base is generated, first char assigned to this base get offset FIRST_ASSIGNED_OFFSET, this value decide how much chars we can append and prepend to first char\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Main/Const.js\n **/","export default class RemoteCommand{\r\n    constructor(){}\r\n\r\n    makeAddCommand(str, id, sessionId){\r\n        this.type = \"add\"\r\n        this.str = str\r\n        this.id = id\r\n        this.sessionId = sessionId\r\n    }\r\n\r\n    makeDelCommand(ids, sessionId){\r\n        this.type = \"del\"\r\n        this.ids = ids\r\n        this.sessionId = sessionId\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Main/RemoteCommand.js\n **/","export default class Base {\r\n    constructor(main, sessionId, clock) {\r\n        this.main = main\r\n        this.sessionId = sessionId\r\n        this.clock = clock\r\n        this.minUsedOffset = MAX_OFFSET + 1\r\n        this.maxUsedOffset = MIN_OFFSET - 1\r\n    }\r\n\r\n    get fullBase() {\r\n        return this.main.concat([this.sessionId], [this.clock])\r\n    }\r\n\r\n    get copy(){\r\n        return new Base(this.main.slice(), this.sessionId, this.clock) \r\n    }\r\n\r\n    isEqual(otherBase) {\r\n        if (this.sessionId !== otherBase.sessionId || this.clock !== otherBase.clock || this.main.length !== otherBase.main.length)\r\n            return false\r\n        for (let i = 0; i < this.main.length; ++i)\r\n            if (this.main[i] != otherBase.main[i])\r\n                return false\r\n\r\n        return true\r\n    }\r\n\r\n    isPrefix(charId){\r\n        let thisId = this.fullBase\r\n        let otherId = charId.fullId\r\n        if(thisId.length > otherId.length)\r\n            return false\r\n        for(let i=0; i<thisId.length; ++i)\r\n            if(thisId[i] != otherId[i])\r\n                return false\r\n        return true;\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Main/LogootDoc/Base.js\n **/","export default class CharId {\r\n    constructor(base, offset) {\r\n        this.base = base\r\n        this.offset = offset\r\n        if (this.offset > base.maxUsedOffset)\r\n            base.maxUsedOffset = this.offset\r\n        if (this.offset < base.minUsedOffset)\r\n            base.minUsedOffset = offset\r\n    }\r\n\r\n    get fullId() {\r\n        return this.base.fullBase.concat(this.offset)\r\n    }\r\n\r\n    get copy(){\r\n        return new CharId(this.base.copy, this.offset)\r\n    }\r\n\r\n    isEqual(otherChar) {\r\n        return this.base.isEqual(otherChar.base)\r\n            && this.offset === otherChar.offset\r\n    }\r\n\r\n    isBigger(otherCharId) {\r\n        let thisId = this.fullId, otherId = otherCharId.fullId\r\n        for (let i = 0; i < Math.min(thisId.length, otherId.length); ++i)\r\n            if (thisId[i] !== otherId[i])\r\n                return thisId[i] > otherId[i]\r\n        return thisId.length > otherId.length\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Main/LogootDoc/CharId.js\n **/","export default class Char {\r\n    constructor(value, id) {\r\n        this.value = value\r\n        this.id = id\r\n    }\r\n\r\n    isEqual(otherChar) {\r\n        return this.value === otherChar.value\r\n            && this.id.isEqual(otherChar.id)\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Main/LogootDoc/Char.js\n **/","import Base from './Base';\r\nimport CharId from './CharId';\r\nimport Char from './Char';\r\n\r\n// At the beginning document contains two chars: DOC_BEG and DOC_END, they're not actual\r\n// text chars and are only used to represent start and end of the document\r\n\r\nvar DOC_BEG = new Char(null, new CharId(new Base([MIN_BASE_EL - 1], MIN_BASE_EL - 1, MIN_BASE_EL - 1), MIN_OFFSET - 1))\r\nvar DOC_END = new Char(null, new CharId(new Base([MAX_BASE_EL + 1], MAX_BASE_EL + 1, MAX_BASE_EL + 1), MAX_OFFSET + 1))\r\n\r\nexport default class Document {\r\n    constructor() {\r\n        this.chars = [DOC_BEG, DOC_END]\r\n        this.bases = []\r\n    }\r\n\r\n    insertStrAppended(str, pos) {\r\n        let charWeAppendTo = this.chars[pos - 1];\r\n        let base = charWeAppendTo.id.base\r\n        let firstOffset = charWeAppendTo.id.offset + 1\r\n        this.insertStringWithExistingBase(str, pos, base, firstOffset)\r\n    }\r\n\r\n    insertStrPrepended(str, pos) {\r\n        let charWePrependTo = this.chars[pos];\r\n        let base = charWePrependTo.id.base\r\n        let firstOffset = charWePrependTo.id.offset - str.length\r\n        this.insertStringWithExistingBase(str, pos, base, firstOffset)\r\n    }\r\n\r\n    insertStringWithExistingBase(str, pos, base, firstOffset = FIRST_ASSIGNED_OFFSET) { //optimize\r\n        this.insertStrAtPos(str, pos, base, firstOffset)\r\n        //this.sortDocumentPart(1, this.chars.length - 1) //VERIFY CHANGE\r\n        this.sortDocumentPart(pos, this.chars.length - 1)\r\n    }\r\n\r\n    insertStringWithNewBase(str, pos, base) {\r\n        this.addBase(base)\r\n        this.insertStringWithExistingBase(str, pos, base)\r\n    }\r\n\r\n    insertStrAtPos(str, pos, base, firstCharOffset) {\r\n        let offset = firstCharOffset\r\n        for (let char of str) {\r\n            let newId = new CharId(base, offset)\r\n            let newChar = new Char(char, newId)\r\n            this.insertCharAtPos(newChar, pos)\r\n            ++pos\r\n            ++offset\r\n        }\r\n    }\r\n\r\n    addCharsAndGetChanges(chars) {\r\n        let changes = []\r\n        if (chars.length == 0)\r\n            return\r\n        let pos0 = this.getPosOfFirstCharWithBiggerId(chars[0].id)\r\n        let prevUsedPos = null\r\n        let changeStr = \"\"\r\n\r\n        for (let i = chars.length - 1; i >= 0; --i) {\r\n            let pos = this.getPosOfFirstCharWithBiggerIdStartingFrom(chars[i].id, pos0)\r\n            if (prevUsedPos === pos || changeStr === \"\") {\r\n                changeStr = chars[i].value + changeStr\r\n            } else {\r\n                let change = { type: \"add\", string: changeStr, position: this.getCoordPos(prevUsedPos) }\r\n                changes.push(change)\r\n                changeStr = chars[i].value\r\n            }\r\n            if (i == 0 && changeStr !== \"\")\r\n                changes.push({ type: \"add\", string: changeStr, position: this.getCoordPos(pos) })\r\n            this.insertCharAtPos(chars[i], pos)\r\n            prevUsedPos = pos\r\n        }\r\n\r\n        return changes\r\n    }\r\n\r\n    getCoordPos(pos) {\r\n        let line = 0\r\n        let column = 0\r\n        for (let i = pos - 1; this.chars[i].value != '\\n' && i > 0; --i){\r\n            column++\r\n        }\r\n        for (let i = 1; i < pos; ++i)\r\n            if (this.chars[i].value == \"\\n\")\r\n                line++\r\n        return { line: line, column: column }\r\n    }\r\n\r\n    sortDocumentPart(sortBeg, sortEnd) {\r\n        for (var pos = sortBeg + 1; pos <= sortEnd; ++pos) {\r\n            var temp = this.chars[pos];\r\n            var prevPos = pos - 1;\r\n            for (; prevPos >= 1 && this.chars[prevPos].id.isBigger(temp.id); --prevPos)\r\n                this.chars[prevPos + 1] = this.chars[prevPos];\r\n            this.chars[prevPos + 1] = temp;\r\n        }\r\n    }\r\n\r\n    addBase(base) {\r\n        this.bases.push(base)\r\n    }\r\n\r\n    delChars(fromPos, toPos) {\r\n        for (let pos = toPos; pos >= fromPos; --pos)\r\n            this.delChar(pos)\r\n    }\r\n\r\n    delChar(pos) {\r\n        this.chars.splice(pos, 1)\r\n    }\r\n\r\n    getPosOfCharWithId(id) {\r\n        for (let pos = 0; pos < this.chars.length; ++pos)\r\n            if (this.chars[pos].id.isEqual(id))\r\n                return pos\r\n        return null\r\n    }\r\n\r\n    getPosOfFirstCharWithBiggerId(charId) {\r\n        for (let pos = 1; pos < this.chars.length; ++pos)\r\n            if (this.chars[pos].id.isBigger(charId))\r\n                return pos\r\n        return null\r\n    }\r\n\r\n    getPosOfFirstCharWithBiggerIdStartingFrom(charId, startPos) {\r\n        for (let pos = startPos; pos < this.chars.length; ++pos)\r\n            if (this.chars[pos].id.isBigger(charId))\r\n                return pos\r\n        return null\r\n    }\r\n\r\n    getCharAtPos(pos) {\r\n        return this.chars[pos]\r\n    }\r\n\r\n    getIdOfCharAtPos(pos) {\r\n        return this.chars[pos].id\r\n    }\r\n\r\n    getCharIds(fromPos, toPos) {\r\n        let ids = []\r\n        for (let i = fromPos; i <= toPos; ++i)\r\n            ids.push(this.chars[i].id)\r\n        return ids;\r\n    }\r\n    getSameBase(base) {\r\n        for (let b of this.bases)\r\n            if (base.isEqual(b))\r\n                return b\r\n        return null\r\n    }\r\n\r\n    insertCharAtPos(char, pos) {\r\n        this.chars.splice(pos, 0, char)\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.chars.length == 2\r\n    }\r\n\r\n    get text() {\r\n        let text = \"\"\r\n        for (let i = 0; i < this.chars.length; ++i)\r\n            text += this.chars[i].value\r\n        return text\r\n    }\r\n\r\n    get textTest() {\r\n        let text = \"\"\r\n        for (let i = 0; i < this.chars.length; ++i) {\r\n            text += (i == 0 || i == this.chars.length - 1 ? \"\" : this.chars[i].value)\r\n            if (i + 1 < this.chars.length && !(this.chars[i].id.base.isEqual(this.chars[i + 1].id.base)))\r\n                text += \"|\"\r\n        }\r\n        return text\r\n    }\r\n\r\n    getAsLines() {\r\n        let lines = []\r\n        let line = []\r\n        for (let i = 1; i < this.chars.length - 1; ++i) {\r\n            line.push(this.chars[i])\r\n            if (this.chars[i].value == '\\n' || i == this.chars.length - 2)\r\n                lines.push(line)\r\n        }\r\n        return lines\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Main/LogootDoc/Document.js\n **/","import Base from './LogootDoc/Base';\r\nimport CharId from './LogootDoc/CharId';\r\nimport Char from './LogootDoc/Char';\r\nimport Document from './LogootDoc/Document';\r\nimport RemoteCommand from './RemoteCommand';\r\n\r\nexport default class Algorithm {\r\n    constructor(doc, sessionId) {\r\n        this.doc = doc\r\n        this.sessionId = sessionId\r\n        this.clock = 0\r\n        this.idsOfCharsToDeleteLater = []\r\n    }\r\n\r\n    insert(str, pos){\r\n        this.insertIntoDocument(str, pos)\r\n        return this.createRemoteAddCommand(str, pos)\r\n    }\r\n\r\n    add(str, strId){\r\n        let chars = this.createCharsFromStr(str, strId)\r\n        for(let i = chars.length-1; i>=0; --i){\r\n            for(let j=this.idsOfCharsToDeleteLater.length-1; j>=0; --j){\r\n                if(chars[i].id.isEqual(this.idsOfCharsToDeleteLater[j])){\r\n                    chars.splice(i,1)\r\n                    this.idsOfCharsToDeleteLater.splice(j,1)\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        let changes = this.doc.addCharsAndGetChanges(chars)\r\n        return changes;\r\n    }\r\n\r\n    remove(fromPos, toPos){\r\n        let delIds = this.doc.getCharIds(fromPos, toPos)\r\n        let delIdsCopy = delIds.map(function(id){return id.copy})\r\n        this.doc.delChars(fromPos, toPos)\r\n        return this.createRemoteDelCommand(delIds)\r\n    }\r\n\r\n    del(ids){ //optimize eg. if consecutive ids then obtain range (pos, pos+length-1)\r\n        for(let id of ids){\r\n            let pos = this.doc.getPosOfCharWithId(id)\r\n            if(pos != null)\r\n                this.doc.delChar(pos)\r\n            else\r\n                this.idsOfCharsToDeleteLater.push(id)\r\n        }\r\n    }\r\n\r\n    createRemoteDelCommand(delIds){\r\n        let remoteDelCommand = new RemoteCommand();\r\n        remoteDelCommand.makeDelCommand(delIds, this.session);\r\n        return remoteDelCommand\r\n    }\r\n\r\n    createCharsFromStr(str, strId){\r\n        let base = this.doc.getSameBase(strId.base)\r\n        if(base == null)\r\n            base = strId.base\r\n        \r\n        let chars = []\r\n        let offset = strId.offset\r\n        for(let char of str){\r\n            chars.push(new Char(char, new CharId(base, offset)))\r\n            ++offset\r\n        }\r\n        return chars;\r\n    }\r\n\r\n    insertIntoDocument(str, pos){\r\n        if(this.canInsertAppended(str, pos))\r\n            this.doc.insertStrAppended(str, pos)\r\n        else if(this.canInsertPrepended(str, pos))\r\n            this.doc.insertStrPrepended(str, pos)\r\n        else\r\n            this.doc.insertStringWithNewBase(str, pos, this.generateBaseAtPos(pos))\r\n    }\r\n\r\n    canInsertAppended(str, pos){\r\n        let charWeAppendTo = this.doc.getCharAtPos(pos - 1)\r\n        return this.isSameSession(charWeAppendTo)\r\n            && this.isHighestOffsetInBase(charWeAppendTo)\r\n            && this.isSpaceInBaseAfter(charWeAppendTo, str.length)\r\n            && this.isNotGoingToOverlapAfterApp(str, pos)\r\n    }\r\n\r\n    isNotGoingToOverlapAfterApp(str, pos){\r\n        let prevCharId = this.doc.getIdOfCharAtPos(pos-1)\r\n        let nextCharId = this.doc.getIdOfCharAtPos(pos)\r\n        let lastIdOfAppStr = prevCharId.copy\r\n        lastIdOfAppStr.offset += str.length\r\n        return !lastIdOfAppStr.isBigger(nextCharId)\r\n    }\r\n\r\n    canInsertPrepended(str, pos){\r\n        let charWePrependTo = this.doc.getCharAtPos(pos)\r\n        return this.isSameSession(charWePrependTo)\r\n            && this.isLowestOffsetInBase(charWePrependTo)\r\n            && this.isSpaceInBaseBefore(charWePrependTo, str.length)\r\n            && this.isNotGoingToOverlapAfterPrep(str, pos)\r\n    }\r\n    \r\n    isNotGoingToOverlapAfterPrep(str, pos){\r\n        let prevCharId = this.doc.getIdOfCharAtPos(pos-1)\r\n        let nextCharId = this.doc.getIdOfCharAtPos(pos)\r\n        let firstIdOfPrepStr = nextCharId.copy\r\n        firstIdOfPrepStr.offset -= str.length\r\n        return !prevCharId.isBigger(firstIdOfPrepStr)\r\n    }\r\n\r\n    isSameSession(char){\r\n        return char.id.base.sessionId == this.sessionId\r\n    }\r\n\r\n    isHighestOffsetInBase(char){\r\n        return char.id.offset == char.id.base.maxUsedOffset\r\n    }\r\n\r\n    isLowestOffsetInBase(char){\r\n        return char.id.offset == char.id.base.minUsedOffset\r\n    }\r\n\r\n    isSpaceInBaseAfter(char, spaceLength){\r\n        return char.id.offset + spaceLength < MAX_BASE_EL\r\n    }\r\n\r\n    isSpaceInBaseBefore(char, spaceLength){\r\n        return char.id.offset - spaceLength > MIN_BASE_EL\r\n    }\r\n\r\n    createRemoteAddCommand(str, pos){\r\n        let addId = this.doc.getCharAtPos(pos).id.copy\r\n        let remoteAddCommand = new RemoteCommand();\r\n        remoteAddCommand.makeAddCommand(str, addId, this.sessionId)\r\n        return remoteAddCommand\r\n    }\r\n\r\n    generateBaseAtPos(pos){\r\n        let idLow = this.doc.getIdOfCharAtPos(pos - 1).fullId\r\n        let idHigh = this.doc.getIdOfCharAtPos(pos).fullId\r\n        let low = idLow[0]\r\n        let high = idHigh[0]\r\n        let base = new Base([], this.sessionId, ++this.clock)\r\n\r\n        for (let i = 1; high - low < 2; ++i) {\r\n            base.main.push(low)\r\n            low = (i < idLow.length ? idLow[i] : MIN_BASE_EL)\r\n            high = (i < idHigh.length ? idHigh[i] : MAX_BASE_EL)\r\n        }\r\n        base.main.push(this.getRandomElementBetween(low + 1, high - 1))\r\n        return base\r\n    }\r\n\r\n    numberOfInsertableCharaters(idInsert, idNext, strLength){\r\n        if(idInsert.base.isPrefix(idNext))\r\n            return 0;\r\n        else\r\n            return strLength\r\n    }\r\n\r\n\r\n    getRandomElementBetween(low, high){\r\n        return Math.floor(Math.random() * (high - low + 1)) + low;\r\n    }\r\n\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Main/Algorithm.js\n **/","import Base from './LogootDoc/Base';\r\nimport CharId from './LogootDoc/CharId';\r\nimport Char from './LogootDoc/Char';\r\nimport Document from './LogootDoc/Document';\r\nimport RemoteCommand from './RemoteCommand';\r\nimport Algorithm from './DocumentChanger';\r\n\r\nexport default class DocumentChanger{\r\n    constructor(algorithm, editor){\r\n        this.algorithm = algorithm\r\n        this.editor = editor\r\n        this.doc = algorithm.doc\r\n        this.sessionId = algorithm.sessionId\r\n        this.lines = this.doc.getAsLines()\r\n    }\r\n\r\n    performInsertAndGetAddCmd(str, line, column){\r\n        let pos = this.convertToAbsolutePos(line, column)\r\n        let addCmd = this.algorithm.insert(str, pos)\r\n        return addCmd\r\n    }\r\n\r\n    addAndGetChanges(str, strId){\r\n        let changes = this.algorithm.add(str, strId)\r\n        //for(let c of changes)\r\n        //    console.log(c.type, c.string, c.position.line, c.position.column)\r\n        return changes\r\n    }\r\n\r\n    convertToAbsolutePos(line, column){\r\n        let pos = 0\r\n        let realDoc = this.editor.getSession().getDocument()\r\n\r\n        if(line > 0)\r\n            for(let i=0; i<line; ++i)\r\n                pos += realDoc.getLine(i).length\r\n\r\n        return pos + line + column + 1\r\n    }\r\n    \r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Main/DocumentChanger.js\n **/"],"sourceRoot":""}